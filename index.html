<!DOCTYPE html>
<html>
<head>
    <title>OIIX NOTAM Live Map</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body { padding: 0; margin: 0; font-family: Arial, sans-serif; }
        #map { height: 100vh; width: 100vw; }
        #error-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border: 3px solid #ff3333;
            border-radius: 12px;
            z-index: 9999;
            text-align: center;
            box-shadow: 0px 0px 20px rgba(0,0,0,0.5);
            font-size: 14px;
            width: 85%;
            max-width: 400px;
        }
        @media (min-width: 768px) {
            #error-modal {
                font-size: 18px;
                max-width: 600px;
                padding: 30px;
            }
        }
        #error-modal img {
            max-width: 100%;
            height: auto;
            max-height: 200px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        #error-modal button {
            margin-top: 20px;
            padding: 8px 20px;
            font-size: 16px;
            cursor: pointer;
            background: #333;
            color: white;
            border: none;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div id="error-modal">
        <img src="Panda.gif" alt="Waiting Panda">
        <br>
        ‚ùå The region for NOTAM <span id="error-notam" style="font-weight:bold;"></span> is not loaded yet ‚ùå<br><br>
        üñ•Ô∏è The server takes a few minutes to update the map üñ•Ô∏è<br><br>
        <b>‚åõ Please try refreshing the page after 3 minutes ‚åõ</b><br>
        <button onclick="document.getElementById('error-modal').style.display='none'">Close</button>
    </div>
    <div id="map"></div>
    <script>
        var map = L.map('map', {
            center: [32.4279, 53.6880],
            zoom: 5,
            zoomSnap: 0.5
        });

        // Create PANES to control stacking order
        map.createPane('firPane');
        map.getPane('firPane').style.zIndex = 390; // Below standard overlays (400)
        
        map.createPane('notamPane');
        map.getPane('notamPane').style.zIndex = 450; // Above everything

        var googleStreets = L.tileLayer('https://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}',{maxZoom: 20, subdomains:['mt0','mt1','mt2','mt3'], attribution: 'Map data ¬© Google'}).addTo(map);
        var googleHybrid = L.tileLayer('https://{s}.google.com/vt/lyrs=y&x={x}&y={y}&z={z}',{maxZoom: 20, subdomains:['mt0','mt1','mt2','mt3'], attribution: 'Map data ¬© Google'});
        var googleSat = L.tileLayer('https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{maxZoom: 20, subdomains:['mt0','mt1','mt2','mt3'], attribution: 'Map data ¬© Google'});
        var googleTerrain = L.tileLayer('https://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}',{maxZoom: 20, subdomains:['mt0','mt1','mt2','mt3'], attribution: 'Map data ¬© Google'});
        
        var baseMaps = {
            "Standard Map": googleStreets,
            "Satellite": googleSat,
            "Hybrid (Satellite + Borders/Roads)": googleHybrid,
            "Terrain": googleTerrain
        };
        
        var firLayer = L.geoJSON(null, {
            pane: 'firPane', // ASSIGN TO LOWER Z-INDEX PANE
            style: function(feature) {
                var isIran = false;
                if (feature.properties) {
                    var id = feature.properties.id || "";
                    var name = feature.properties.FIRname || "";
                    if (id === "OIIX" || name.indexOf("Tehran") !== -1) {
                        isIran = true;
                    }
                }
                return {
                    color: "#0055ff", 
                    weight: 2, 
                    fillOpacity: isIran ? 0.15 : 0.0
                };
            },
            onEachFeature: function(feature, layer) {
                if (feature.properties && feature.properties.id) {
                    layer.bindPopup("<b>FIR Airspace:</b> " + feature.properties.id);
                }
            }
        });

        fetch('https://raw.githubusercontent.com/vatsimnetwork/vatspy-data-project/master/Boundaries.geojson')
            .then(res => {
                if (!res.ok) throw new Error("Network response was not ok");
                return res.json();
            })
            .then(data => firLayer.addData(data))
            .catch(err => console.error("Could not load FIR boundaries:", err));

        var overlayMaps = {
            "Show Airspace Boundaries (FIR)": firLayer
        };
        
        L.control.layers(baseMaps, overlayMaps).addTo(map);
        
        var markers = {};
markers['A3716/25'] = L.polygon([[28.450833, 52.095278], [28.633611, 53.423056], [28.383333, 53.6], [27.95, 53.883333], [27.251111, 54.478889], [26.766667, 51.699444]], {color: '#ffa500', weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> A3716/25<br><b>NOTAM Subject:</b> Control area (CTA)<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2025/12/11 11:15 to 2026/03/12 00:00');
markers['A0065/26'] = L.polygon([[35.416667, 46.85], [35.416667, 47], [35.25, 46.85], [35.333333, 46.75]], {color: '#ffa500', weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> A0065/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/01/08 15:00 to 2026/03/19 18:00');
markers['B0038/26'] = L.polygon([[35.550556, 61.220278], [35.533333, 61.2575], [35.483333, 61.233056], [35.516667, 61.195278]], {color: '#ffa500', weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0038/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/01/13 09:26 to 2026/03/19 22:00');
markers['A0205/26'] = L.polygon([[31.750556, 60.775556], [31.601389, 60.775556], [31.601389, 60.676667], [31.750556, 60.676667]], {color: '#ffa500', weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> A0205/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/01/13 09:28 to 2026/03/19 23:00');
markers['B0039/26'] = L.polygon([[33.383333, 60.733333], [33.366667, 60.733333], [33.366667, 60.716667], [33.383333, 60.716667]], {color: '#ffa500', weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0039/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/01/13 09:43 to 2026/03/19 22:00');
markers['B0040/26'] = L.polygon([[37.083333, 45.75], [37, 45.5], [37, 45.083333], [37.166667, 45.5]], {color: '#ffa500', weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0040/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/01/13 09:51 to 2026/03/19 22:00');
markers['A0207/26'] = L.polygon([[31.216667, 59.516667], [31.05, 59.6], [31.016667, 59.4], [31.2, 59.316667]], {color: '#ffa500', weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> A0207/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/01/13 09:51 to 2026/03/20 00:00');
markers['B0041/26'] = L.polygon([[34.95, 59.216667], [34.9, 59.216667], [34.916667, 59.2], [34.95, 59.2]], {color: '#ffa500', weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0041/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/01/13 09:55 to 2026/03/19 22:00');
markers['B0068/26'] = L.circle([35.683333, 61.166667], {color: '#ffa500', radius: 7408, weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0068/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/01/26 07:00 to 2026/02/25 17:00');
markers['B0065/26'] = L.circle([35.9, 47.05], {color: '#ffa500', radius: 5556, weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0065/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/01/26 08:00 to 2026/02/25 14:00');
markers['B0067/26'] = L.circle([35.3, 46.366667], {color: '#ffa500', radius: 5556, weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0067/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/01/26 08:00 to 2026/02/25 14:00');
markers['B0069/26'] = L.circle([36.783333, 46.933333], {color: '#ffa500', radius: 1852, weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0069/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/01/26 08:00 to 2026/02/25 14:00');
markers['B0070/26'] = L.circle([35.316667, 46.366667], {color: '#ffa500', radius: 1852, weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0070/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/01/26 08:00 to 2026/02/25 14:00');
markers['B0081/26'] = L.polygon([[34.983333, 61.023611], [34.967778, 60.980556], [34.934167, 60.990278], [34.95, 61.033056]], {color: '#ffa500', weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0081/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/01/27 10:08 to 2026/03/19 22:00');
markers['B0072/26'] = L.circle([31.216667, 59.4], {color: '#ffa500', radius: 12964, weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0072/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/02/09 07:00 to 2026/02/23 19:00');
markers['B0090/26'] = L.circle([31.483333, 60.783333], {color: '#ffa500', radius: 7408, weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0090/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/02/09 07:00 to 2026/03/12 00:00');
markers['B0091/26'] = L.circle([33.35, 60.733333], {color: '#ffa500', radius: 5556, weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0091/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/02/09 07:00 to 2026/03/12 00:00');
markers['B0092/26'] = L.circle([33.733333, 60.533333], {color: '#ffa500', radius: 3704, weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0092/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/02/09 07:00 to 2026/03/12 00:00');
markers['B0093/26'] = L.circle([31.8, 60.8], {color: '#ffa500', radius: 7408, weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0093/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/02/09 07:00 to 2026/03/12 00:00');
markers['B0095/26'] = L.circle([32.583333, 59.733333], {color: '#ffa500', radius: 5556, weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0095/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/02/09 07:00 to 2026/03/01 14:00');
markers['B0102/26'] = L.circle([32.383333, 60.833333], {color: '#ffa500', radius: 7408, weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0102/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/02/09 07:00 to 2026/03/12 00:00');
markers['B0106/26'] = L.polygon([[36.8, 49.266111], [36.784167, 49.271667], [36.784167, 49.270833], [36.783889, 49.266111], [36.783889, 49.258611]], {color: '#ffa500', weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0106/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/02/18 08:00 to 2026/02/24 00:00');
markers['B0137/26'] = L.circle([29.833333, 59.95], {color: '#ffa500', radius: 5556, weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0137/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/02/24 06:00 to 2026/03/02 18:00');
markers['B0138/26'] = L.circle([33.2, 46.25], {color: '#ffa500', radius: 7408, weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0138/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/02/24 07:00 to 2026/03/05 23:00');
markers['B0140/26'] = L.circle([33.483333, 46.116667], {color: '#ffa500', radius: 7408, weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0140/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/02/24 13:00 to 2026/03/05 22:00');
markers['A0589/26'] = L.polygon([[33.4, 47.983333], [33.366667, 48.05], [33.35, 48.033333], [33.383333, 47.966667]], {color: '#ffa500', weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> A0589/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/02/25 07:00 to 2026/03/18 10:00');
markers['B0141/26'] = L.circle([32.733333, 47.266667], {color: '#ffa500', radius: 7408, weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0141/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/02/28 07:00 to 2026/03/18 00:00');
markers['B0142/26'] = L.polygon([[36.8, 49.266111], [36.784167, 49.271667], [36.784167, 49.270833], [36.783889, 49.266111], [36.783889, 49.258611]], {color: '#ffa500', weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0142/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/03/03 08:00 to 2026/03/10 00:00');
markers['B0139/26'] = L.circle([32.533333, 55.233333], {color: '#ffa500', radius: 5556, weight: 2, fillOpacity: 0.3, pane: 'notamPane'}).addTo(map).bindPopup('<b>NOTAM Number:</b> B0139/26<br><b>NOTAM Subject:</b> Missile, gun or rocket firing<br><b>Importance level:</b> 2Ô∏è‚É£ Second<br><b>NOTAM time:</b> 2026/03/06 07:00 to 2026/03/16 17:00');

        
        setTimeout(function() {
            var hash = window.location.hash.substring(1);
            if (hash) {
                if (markers[hash]) {
                    var layer = markers[hash];
                    if (layer.getBounds) {
                        map.fitBounds(layer.getBounds(), {padding: [150, 150], maxZoom: 7});
                    } else if (layer.getLatLng) {
                        map.setView(layer.getLatLng(), 7);
                    }
                    layer.openPopup();
                } else {
                    document.getElementById('error-notam').innerText = hash;
                    document.getElementById('error-modal').style.display = 'block';
                }
            }
        }, 500);
    </script>
</body>
</html>